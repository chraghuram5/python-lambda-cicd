name: workflow

on: push

jobs:
  workflow-job:

    runs-on: ubuntu-latest

    steps:
      - name: Checkout Repository
        uses: actions/checkout@v2

      - name: Print workflow_run information
        run: echo "$GITHUB_CONTEXT"

      - name: Check for PR to Main for the current branch for this branch
        run: |
          BRANCH_NAME=$(git rev-parse --abbrev-ref HEAD)
          echo "$BRANCH_NAME"
          PR_COUNT=$(curl -s -H "Authorization: Bearer ${{ secrets.GITHUB_TOKEN }}" \
                     -H "Accept: application/vnd.github.v3+json" \
                     "https://api.github.com/repos/${{ github.repository }}/pulls?state=open&base=main" | \
                     jq --arg BRANCH_NAME "$BRANCH_NAME" \
                     '.[] | select(.head.ref == $BRANCH_NAME) | .[]' )
          echo "$PR_COUNT"
          if [ "$PR_COUNT" -gt 0 ]; then
            echo "Branch has open pull request to main."
          else
            echo "Branch does not have open pull request to main."
          fi
